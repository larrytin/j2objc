//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//
//  Created by Larry Tin <dev@goodow.com>
//

#include "IOSIntArray.h"
#include "java/io/Serializable.h"
#include "java/lang/StringBuilder.h"
#include "java/util/concurrent/atomic/AtomicIntegerArray.h"
#include <libkern/OSAtomic.h>

@implementation JavaUtilConcurrentAtomicAtomicIntegerArray

+ (NSArray *)memDebugStaticReferences {
  NSMutableArray *result = [NSMutableArray array];
  return result;
}

- (id)initWithInt:(int)length {
  if (self = [super init]) {
    JavaUtilConcurrentAtomicAtomicIntegerArray_set_array_(self, [IOSIntArray arrayWithLength:length]);
    JreMemDebugAdd(self);
  }
  return self;
}

- (id)initWithIntArray:(IOSIntArray *)array {
  if (self = [super init]) {
    JavaUtilConcurrentAtomicAtomicIntegerArray_set_array_(self, [((IOSIntArray *) nil_chk(array)) clone]);
    JreMemDebugAdd(self);
  }
  return self;
}

- (int)length {
  return (int) [((IOSIntArray *) nil_chk(array_)) count];
}

- (int)getWithInt:(int)i {
  [JavaUtilConcurrentAtomicAtomicIntegerArray memoryBarrier];
  return IOSIntArray_Get(nil_chk(array_), i);
}

- (void)setWithInt:(int)i
           withInt:(int)newValue {
  [self getAndSetWithInt:i withInt:newValue];
}

- (void)lazySetWithInt:(int)i
               withInt:(int)newValue {
  [self getAndSetWithInt:i withInt:newValue];
}

- (int)getAndSetWithInt:(int)i
                withInt:(int)newValue {
  while (YES) {
    int current = IOSIntArray_Get(nil_chk(array_), i);
    if ([self compareAndSetRawWithInt:i withInt:current withInt:newValue]) return current;
  }
}

- (BOOL)compareAndSetWithInt:(int)i
                     withInt:(int)expect
                     withInt:(int)update {
  return [self compareAndSetRawWithInt:i withInt:expect withInt:update];
}

- (BOOL)weakCompareAndSetWithInt:(int)i
                         withInt:(int)expect
                         withInt:(int)update {
  return [self compareAndSetRawWithInt:i withInt:expect withInt:update];
}

- (int)getAndIncrementWithInt:(int)i {
  return [self getAndAddWithInt:i withInt:1];
}

- (int)getAndDecrementWithInt:(int)i {
  return [self getAndAddWithInt:i withInt:-1];
}

- (int)getAndAddWithInt:(int)i
                withInt:(int)delta {
  while (YES) {
    int current = IOSIntArray_Get(nil_chk(array_), i);
    if ([self compareAndSetRawWithInt:i withInt:current withInt:current + delta]) return current;
  }
}

- (int)incrementAndGetWithInt:(int)i {
  return [self addAndGetWithInt:i withInt:1];
}

- (int)decrementAndGetWithInt:(int)i {
  return [self addAndGetWithInt:i withInt:-1];
}

- (int)addAndGetWithInt:(int)i
                withInt:(int)delta {
  while (YES) {
    int current = IOSIntArray_Get(nil_chk(array_), i);
    int next = current + delta;
    if ([self compareAndSetRawWithInt:i withInt:current withInt:next]) return next;
  }
}

- (NSString *)description {
  int iMax = (int) [((IOSIntArray *) nil_chk(array_)) count] - 1;
  if (iMax == -1) return @"[]";
  JavaLangStringBuilder *b = [[[JavaLangStringBuilder alloc] init] autorelease];
  [b appendWithChar:'['];
  for (int i = 0; ; i++) {
    [b appendWithInt:IOSIntArray_Get(array_, i)];
    if (i == iMax) return [((JavaLangStringBuilder *) nil_chk([b appendWithChar:']'])) description];
    [((JavaLangStringBuilder *) nil_chk([b appendWithChar:','])) appendWithChar:' '];
  }
}

+ (void)memoryBarrier {
  OSMemoryBarrier();
}

- (BOOL)compareAndSetRawWithInt:(int)i
                        withInt:(int)expect
                        withInt:(int)update {
  return OSAtomicCompareAndSwapIntBarrier(expect, update, [array_ intRefAtIndex:i]);
}

- (void)dealloc {
  JreMemDebugRemove(self);
  JavaUtilConcurrentAtomicAtomicIntegerArray_set_array_(self, nil);
  [super dealloc];
}

- (void)copyAllFieldsTo:(JavaUtilConcurrentAtomicAtomicIntegerArray *)other {
  [super copyAllFieldsTo:other];
  JavaUtilConcurrentAtomicAtomicIntegerArray_set_array_(other, array_);
}

- (NSArray *)memDebugStrongReferences {
  NSMutableArray *result =
      [[[super memDebugStrongReferences] mutableCopy] autorelease];
  [result addObject:[JreMemDebugStrongReference strongReferenceWithObject:array_ name:@"array"]];
  return result;
}

@end
