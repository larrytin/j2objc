//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//
//  Created by Larry Tin <dev@goodow.com>
//

#include "IOSIntArray.h"
#include "IOSLongArray.h"
#include "java/util/Calendar.h"
#include "java/util/Grego.h"

@implementation JavaUtilGrego

+ (NSArray *)memDebugStaticReferences {
  NSMutableArray *result = [NSMutableArray array];
  [result addObject:[JreMemDebugStrongReference strongReferenceWithObject:JavaUtilGrego_MONTH_LENGTH_ name:@"JavaUtilGrego_MONTH_LENGTH_"]];
  [result addObject:[JreMemDebugStrongReference strongReferenceWithObject:JavaUtilGrego_DAYS_BEFORE_ name:@"JavaUtilGrego_DAYS_BEFORE_"]];
  return result;
}

static IOSIntArray * JavaUtilGrego_MONTH_LENGTH_;
static IOSIntArray * JavaUtilGrego_DAYS_BEFORE_;

+ (long long int)MIN_MILLIS {
  return JavaUtilGrego_MIN_MILLIS;
}

+ (long long int)MAX_MILLIS {
  return JavaUtilGrego_MAX_MILLIS;
}

+ (int)MILLIS_PER_SECOND {
  return JavaUtilGrego_MILLIS_PER_SECOND;
}

+ (int)MILLIS_PER_MINUTE {
  return JavaUtilGrego_MILLIS_PER_MINUTE;
}

+ (int)MILLIS_PER_HOUR {
  return JavaUtilGrego_MILLIS_PER_HOUR;
}

+ (int)MILLIS_PER_DAY {
  return JavaUtilGrego_MILLIS_PER_DAY;
}

+ (IOSIntArray *)MONTH_LENGTH {
  return JavaUtilGrego_MONTH_LENGTH_;
}

+ (IOSIntArray *)DAYS_BEFORE {
  return JavaUtilGrego_DAYS_BEFORE_;
}

+ (BOOL)isLeapYearWithInt:(int)year {
  return ((year & (int) 0x3) == 0) && ((year % 100 != 0) || (year % 400 == 0));
}

+ (int)monthLengthWithInt:(int)year
                  withInt:(int)month {
  return IOSIntArray_Get(nil_chk(JavaUtilGrego_MONTH_LENGTH_), month + ([JavaUtilGrego isLeapYearWithInt:year] ? 12 : 0));
}

+ (int)previousMonthLengthWithInt:(int)year
                          withInt:(int)month {
  return (month > 0) ? [JavaUtilGrego monthLengthWithInt:year withInt:month - 1] : 31;
}

+ (long long int)fieldsToDayWithInt:(int)year
                            withInt:(int)month
                            withInt:(int)dom {
  int y = year - 1;
  long long int julian = 365 * y + [JavaUtilGrego floorDivideWithLong:y withLong:4] + (JavaUtilGrego_JULIAN_1_CE - 3) + [JavaUtilGrego floorDivideWithLong:y withLong:400] - [JavaUtilGrego floorDivideWithLong:y withLong:100] + 2 + IOSIntArray_Get(nil_chk(JavaUtilGrego_DAYS_BEFORE_), month + ([JavaUtilGrego isLeapYearWithInt:year] ? 12 : 0)) + dom;
  return julian - JavaUtilGrego_JULIAN_1970_CE;
}

+ (int)dayOfWeekWithLong:(long long int)day {
  IOSLongArray *remainder = [IOSLongArray arrayWithLength:1];
  [JavaUtilGrego floorDivideWithLong:day + JavaUtilCalendar_THURSDAY withLong:7 withLongArray:remainder];
  int dayOfWeek = (int) IOSLongArray_Get(remainder, 0);
  dayOfWeek = (dayOfWeek == 0) ? 7 : dayOfWeek;
  return dayOfWeek;
}

+ (IOSIntArray *)dayToFieldsWithLong:(long long int)day
                        withIntArray:(IOSIntArray *)fields {
  if (fields == nil || (int) [fields count] < 5) {
    fields = [IOSIntArray arrayWithLength:5];
  }
  day += JavaUtilGrego_JULIAN_1970_CE - JavaUtilGrego_JULIAN_1_CE;
  IOSLongArray *rem = [IOSLongArray arrayWithLength:1];
  long long int n400 = [JavaUtilGrego floorDivideWithLong:day withLong:146097 withLongArray:rem];
  long long int n100 = [JavaUtilGrego floorDivideWithLong:IOSLongArray_Get(rem, 0) withLong:36524 withLongArray:rem];
  long long int n4 = [JavaUtilGrego floorDivideWithLong:IOSLongArray_Get(rem, 0) withLong:1461 withLongArray:rem];
  long long int n1 = [JavaUtilGrego floorDivideWithLong:IOSLongArray_Get(rem, 0) withLong:365 withLongArray:rem];
  int year = (int) (400 * n400 + 100 * n100 + 4 * n4 + n1);
  int dayOfYear = (int) IOSLongArray_Get(rem, 0);
  if (n100 == 4 || n1 == 4) {
    dayOfYear = 365;
  }
  else {
    ++year;
  }
  BOOL isLeap = [JavaUtilGrego isLeapYearWithInt:year];
  int correction = 0;
  int march1 = isLeap ? 60 : 59;
  if (dayOfYear >= march1) {
    correction = isLeap ? 1 : 2;
  }
  int month = (12 * (dayOfYear + correction) + 6) / 367;
  int dayOfMonth = dayOfYear - IOSIntArray_Get(nil_chk(JavaUtilGrego_DAYS_BEFORE_), isLeap ? month + 12 : month) + 1;
  int dayOfWeek = (int) ((day + 2) % 7);
  if (dayOfWeek < 1) {
    dayOfWeek += 7;
  }
  dayOfYear++;
  (*IOSIntArray_GetRef(nil_chk(fields), 0)) = year;
  (*IOSIntArray_GetRef(fields, 1)) = month;
  (*IOSIntArray_GetRef(fields, 2)) = dayOfMonth;
  (*IOSIntArray_GetRef(fields, 3)) = dayOfWeek;
  (*IOSIntArray_GetRef(fields, 4)) = dayOfYear;
  return fields;
}

+ (IOSIntArray *)timeToFieldsWithLong:(long long int)time
                         withIntArray:(IOSIntArray *)fields {
  if (fields == nil || (int) [fields count] < 6) {
    fields = [IOSIntArray arrayWithLength:6];
  }
  IOSLongArray *remainder = [IOSLongArray arrayWithLength:1];
  long long int day = [JavaUtilGrego floorDivideWithLong:time withLong:24 * 60 * 60 * 1000 withLongArray:remainder];
  [JavaUtilGrego dayToFieldsWithLong:day withIntArray:fields];
  (*IOSIntArray_GetRef(nil_chk(fields), 5)) = (int) IOSLongArray_Get(remainder, 0);
  return fields;
}

+ (long long int)floorDivideWithLong:(long long int)numerator
                            withLong:(long long int)denominator {
  return (numerator >= 0) ? numerator / denominator : ((numerator + 1) / denominator) - 1;
}

+ (long long int)floorDivideWithLong:(long long int)numerator
                            withLong:(long long int)denominator
                       withLongArray:(IOSLongArray *)remainder {
  if (numerator >= 0) {
    (*IOSLongArray_GetRef(nil_chk(remainder), 0)) = numerator % denominator;
    return numerator / denominator;
  }
  long long int quotient = ((numerator + 1) / denominator) - 1;
  (*IOSLongArray_GetRef(nil_chk(remainder), 0)) = numerator - (quotient * denominator);
  return quotient;
}

+ (int)getDayOfWeekInMonthWithInt:(int)year
                          withInt:(int)month
                          withInt:(int)dayOfMonth {
  int weekInMonth = (dayOfMonth + 6) / 7;
  if (weekInMonth == 4) {
    if (dayOfMonth + 7 > [JavaUtilGrego monthLengthWithInt:year withInt:month]) {
      weekInMonth = -1;
    }
  }
  else if (weekInMonth == 5) {
    weekInMonth = -1;
  }
  return weekInMonth;
}

- (id)init {
  return JreMemDebugAdd([super init]);
}

+ (void)initialize {
  if (self == [JavaUtilGrego class]) {
    JreOperatorRetainedAssign(&JavaUtilGrego_MONTH_LENGTH_, nil, [IOSIntArray arrayWithInts:(int[]){ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 } count:24]);
    JreOperatorRetainedAssign(&JavaUtilGrego_DAYS_BEFORE_, nil, [IOSIntArray arrayWithInts:(int[]){ 0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 0, 31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335 } count:24]);
  }
}

@end
