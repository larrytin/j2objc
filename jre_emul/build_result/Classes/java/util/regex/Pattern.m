//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: android/libcore/luni/src/main/java/java/util/regex/Pattern.java
//
//  Created by retechretech on 13-9-4.
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "java/lang/CharSequence.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/NullPointerException.h"
#include "java/lang/StringBuilder.h"
#include "java/lang/Throwable.h"
#include "java/lang/UnsupportedOperationException.h"
#include "java/util/regex/Matcher.h"
#include "java/util/regex/Pattern.h"
#include "java/util/regex/PatternSyntaxException.h"
#include "java/util/regex/Splitter.h"
#import "java/util/regex/PatternSyntaxException.h"

@implementation JavaUtilRegexPattern

+ (NSArray *)memDebugStaticReferences {
  NSMutableArray *result = [NSMutableArray array];
  return result;
}

+ (int)UNIX_LINES {
  return JavaUtilRegexPattern_UNIX_LINES;
}

+ (int)CASE_INSENSITIVE {
  return JavaUtilRegexPattern_CASE_INSENSITIVE;
}

+ (int)COMMENTS {
  return JavaUtilRegexPattern_COMMENTS;
}

+ (int)MULTILINE {
  return JavaUtilRegexPattern_MULTILINE;
}

+ (int)LITERAL {
  return JavaUtilRegexPattern_LITERAL;
}

+ (int)DOTALL {
  return JavaUtilRegexPattern_DOTALL;
}

+ (int)UNICODE_CASE {
  return JavaUtilRegexPattern_UNICODE_CASE;
}

+ (int)CANON_EQ {
  return JavaUtilRegexPattern_CANON_EQ;
}

- (JavaUtilRegexMatcher *)matcherWithJavaLangCharSequence:(id<JavaLangCharSequence>)input {
  return [[[JavaUtilRegexMatcher alloc] initWithJavaUtilRegexPattern:self withJavaLangCharSequence:input] autorelease];
}

- (IOSObjectArray *)splitWithJavaLangCharSequence:(id<JavaLangCharSequence>)input
                                          withInt:(int)limit {
  return [JavaUtilRegexSplitter splitWithJavaUtilRegexPattern:self withNSString:pattern__ withNSString:[((id<JavaLangCharSequence>) nil_chk(input)) sequenceDescription] withInt:limit];
}

- (IOSObjectArray *)splitWithJavaLangCharSequence:(id<JavaLangCharSequence>)input {
  return [self splitWithJavaLangCharSequence:input withInt:0];
}

- (NSString *)pattern {
  return pattern__;
}

- (NSString *)description {
  return pattern__;
}

- (int)flags {
  return flags__;
}

+ (JavaUtilRegexPattern *)compileWithNSString:(NSString *)regularExpression
                                      withInt:(int)flags {
  return [[[JavaUtilRegexPattern alloc] initWithNSString:regularExpression withInt:flags] autorelease];
}

+ (IOSObjectArray *)__exceptions_compileWithNSString_withInt_ {
  return [IOSObjectArray arrayWithObjects:(id[]) { [JavaUtilRegexPatternSyntaxException getClass] } count:1 type:[IOSClass getClass]];
}

+ (JavaUtilRegexPattern *)compileWithNSString:(NSString *)pattern {
  return [[[JavaUtilRegexPattern alloc] initWithNSString:pattern withInt:0] autorelease];
}

- (id)initWithNSString:(NSString *)pattern
               withInt:(int)flags {
  if ((self = [super init])) {
    if ((flags & ~JavaUtilRegexPattern_ALL_FLAGS) != 0) {
      @throw [[[JavaLangIllegalArgumentException alloc] initWithNSString:@"unknown flag"] autorelease];
    }
    if ((flags & JavaUtilRegexPattern_CANON_EQ) != 0) {
      @throw [[[JavaLangUnsupportedOperationException alloc] initWithNSString:@"CANON_EQ flag not supported"] autorelease];
    }
    JavaUtilRegexPattern_set_pattern__(self, pattern);
    self->flags__ = flags;
    [self compile];
    JreMemDebugAdd(self);
  }
  return self;
}

+ (IOSObjectArray *)__exceptions_JavaUtilRegexPatternWithNSString_withInt_ {
  return [IOSObjectArray arrayWithObjects:(id[]) { [JavaUtilRegexPatternSyntaxException getClass] } count:1 type:[IOSClass getClass]];
}

- (void)compile {
  if (pattern__ == nil) {
    @throw [[[JavaLangNullPointerException alloc] initWithNSString:@"pattern == null"] autorelease];
  }
  NSString *icuPattern = pattern__;
  if ((flags__ & JavaUtilRegexPattern_LITERAL) != 0) {
    icuPattern = [JavaUtilRegexPattern quoteWithNSString:pattern__];
  }
  int iosFlags = [self javaToIosFlags];
  [self compileImplWithNSString:icuPattern withInt:iosFlags];
}

+ (IOSObjectArray *)__exceptions_compile {
  return [IOSObjectArray arrayWithObjects:(id[]) { [JavaUtilRegexPatternSyntaxException getClass] } count:1 type:[IOSClass getClass]];
}

- (int)javaToIosFlags {
  int iosFlags = 0;
  if ((flags__ & JavaUtilRegexPattern_CASE_INSENSITIVE) > 0) {
    iosFlags |= 1 << 0;
  }
  if ((flags__ & JavaUtilRegexPattern_COMMENTS) > 0) {
    iosFlags |= 1 << 1;
  }
  if ((flags__ & JavaUtilRegexPattern_LITERAL) > 0) {
    iosFlags |= 1 << 2;
  }
  if ((flags__ & JavaUtilRegexPattern_DOTALL) > 0) {
    iosFlags |= 1 << 3;
  }
  if ((flags__ & JavaUtilRegexPattern_MULTILINE) > 0) {
    iosFlags |= 1 << 4;
  }
  if ((flags__ & JavaUtilRegexPattern_UNIX_LINES) > 0) {
    iosFlags |= 1 << 5;
  }
  if ((flags__ & JavaUtilRegexPattern_UNICODE_CASE) > 0) {
    iosFlags |= 1 << 6;
  }
  return iosFlags;
}

+ (BOOL)matchesWithNSString:(NSString *)regularExpression
   withJavaLangCharSequence:(id<JavaLangCharSequence>)input {
  return [((JavaUtilRegexMatcher *) [[[JavaUtilRegexMatcher alloc] initWithJavaUtilRegexPattern:[[[JavaUtilRegexPattern alloc] initWithNSString:regularExpression withInt:0] autorelease] withJavaLangCharSequence:input] autorelease]) matches];
}

+ (NSString *)quoteWithNSString:(NSString *)string {
  JavaLangStringBuilder *sb = [[[JavaLangStringBuilder alloc] init] autorelease];
  [sb appendWithNSString:@"\\Q"];
  int apos = 0;
  int k;
  while ((k = [((NSString *) nil_chk(string)) indexOfString:@"\\E" fromIndex:apos]) >= 0) {
    [((JavaLangStringBuilder *) nil_chk([sb appendWithNSString:[string substring:apos endIndex:k + 2]])) appendWithNSString:@"\\\\E\\Q"];
    apos = k + 2;
  }
  return [((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk([sb appendWithNSString:[string substring:apos]])) appendWithNSString:@"\\E"])) description];
}

- (void)dealloc {
  @try {
    [self releaseNativePattern];
    JavaUtilRegexPattern_set_nativePattern_(self, nil);
    JavaUtilRegexPattern_set_pattern__(self, nil);
  }
  @finally {
    [super dealloc];
  }
}

+ (IOSObjectArray *)__exceptions_dealloc {
  return [IOSObjectArray arrayWithObjects:(id[]) { [JavaLangThrowable getClass] } count:1 type:[IOSClass getClass]];
}

- (void)compileImplWithNSString:(NSString *)icuPattern
                        withInt:(int)iosFlags   {
    NSError *error = NULL;
    NSRegularExpression *regex =
    [NSRegularExpression regularExpressionWithPattern:icuPattern
    options:iosFlags
    error:&error];
    if (error != NULL) {
      id exception = AUTORELEASE([[JavaUtilRegexPatternSyntaxException alloc]
      initWithNSString:[error localizedDescription]
      withNSString:icuPattern
      withInt:-1]);
      @throw exception;
    }
    #if ! __has_feature(objc_arc)
    [regex retain];
    #endif
    nativePattern_ = regex;
  }

- (void)releaseNativePattern   {
    #if ! __has_feature(objc_arc)
    [nativePattern_ release];
    #endif
    nativePattern_ = 0;
  }

- (void)copyAllFieldsTo:(JavaUtilRegexPattern *)other {
  [super copyAllFieldsTo:other];
  other->flags__ = flags__;
  JavaUtilRegexPattern_set_nativePattern_(other, nativePattern_);
  JavaUtilRegexPattern_set_pattern__(other, pattern__);
}

- (NSArray *)memDebugStrongReferences {
  NSMutableArray *result =
      [[[super memDebugStrongReferences] mutableCopy] autorelease];
  [result addObject:[JreMemDebugStrongReference strongReferenceWithObject:pattern__ name:@"pattern_"]];
  [result addObject:[JreMemDebugStrongReference strongReferenceWithObject:nativePattern_ name:@"nativePattern"]];
  return result;
}

@end
