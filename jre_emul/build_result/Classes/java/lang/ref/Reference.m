//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: android/libcore/luni/src/main/java/java/lang/ref/Reference.java
//
//  Created by retechretech on 13-9-25.
//

#include "java/lang/ref/Reference.h"
#include "java/lang/ref/ReferenceQueue.h"
#import "IOSReference.h"

@implementation JavaLangRefReference

+ (NSArray *)memDebugStaticReferences {
  NSMutableArray *result = [NSMutableArray array];
  return result;
}

- (id)init {
  return JreMemDebugAdd([super init]);
}

- (id)initWithId:(id)r
withJavaLangRefReferenceQueue:(JavaLangRefReferenceQueue *)q {
  if (self = [super init]) {
    referent_ = r;
    queue_ = q;
    [self initReferent];
    JreMemDebugAdd(self);
  }
  return self;
}

- (void)clear {
  referent_ = nil;
}

- (BOOL)enqueueInternal {
  @synchronized(self) {
    {
      if (queue_ != nil && queueNext_ == nil) {
        [queue_ enqueueWithJavaLangRefReference:self];
        queue_ = nil;
        return YES;
      }
      return NO;
    }
  }
}

- (BOOL)enqueue {
  return [self enqueueInternal];
}

- (id)get {
  return referent_;
}

- (BOOL)isEnqueued {
  return queueNext_ != nil;
}

- (void)dealloc {
  JreMemDebugRemove(self);
  [self deallocReferent];
  JavaLangRefReference_set_pendingNext_(self, nil);
  JavaLangRefReference_set_queueNext_(self, nil);
  [super dealloc];
}

- (void)initReferent {
  [IOSReference initReferent:self];
}

- (void)strengthenReferent {
  [IOSReference strengthenReferent:self];
}

- (void)weakenReferent {
  [IOSReference weakenReferent:self];
}

- (void)deallocReferent {
  [IOSReference deallocReferent:self];
}

- (void)copyAllFieldsTo:(JavaLangRefReference *)other {
  [super copyAllFieldsTo:other];
  JavaLangRefReference_set_pendingNext_(other, pendingNext_);
  other->queue_ = queue_;
  JavaLangRefReference_set_queueNext_(other, queueNext_);
  other->referent_ = referent_;
}

- (NSArray *)memDebugStrongReferences {
  NSMutableArray *result =
      [[[super memDebugStrongReferences] mutableCopy] autorelease];
  [result addObject:[JreMemDebugStrongReference strongReferenceWithObject:queueNext_ name:@"queueNext"]];
  [result addObject:[JreMemDebugStrongReference strongReferenceWithObject:pendingNext_ name:@"pendingNext"]];
  return result;
}

@end
