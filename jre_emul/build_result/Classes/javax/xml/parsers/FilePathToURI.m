//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//
//  Created by Larry Tin <dev@goodow.com>
//

#include "IOSBooleanArray.h"
#include "IOSByteArray.h"
#include "IOSCharArray.h"
#include "java/io/File.h"
#include "java/io/UnsupportedEncodingException.h"
#include "java/lang/Character.h"
#include "java/lang/StringBuilder.h"
#include "javax/xml/parsers/FilePathToURI.h"

@implementation JavaxXmlParsersFilePathToURI

+ (NSArray *)memDebugStaticReferences {
  NSMutableArray *result = [NSMutableArray array];
  [result addObject:[JreMemDebugStrongReference strongReferenceWithObject:JavaxXmlParsersFilePathToURI_gNeedEscaping_ name:@"JavaxXmlParsersFilePathToURI_gNeedEscaping_"]];
  [result addObject:[JreMemDebugStrongReference strongReferenceWithObject:JavaxXmlParsersFilePathToURI_gAfterEscaping1_ name:@"JavaxXmlParsersFilePathToURI_gAfterEscaping1_"]];
  [result addObject:[JreMemDebugStrongReference strongReferenceWithObject:JavaxXmlParsersFilePathToURI_gAfterEscaping2_ name:@"JavaxXmlParsersFilePathToURI_gAfterEscaping2_"]];
  [result addObject:[JreMemDebugStrongReference strongReferenceWithObject:JavaxXmlParsersFilePathToURI_gHexChs_ name:@"JavaxXmlParsersFilePathToURI_gHexChs_"]];
  return result;
}

static IOSBooleanArray * JavaxXmlParsersFilePathToURI_gNeedEscaping_;
static IOSCharArray * JavaxXmlParsersFilePathToURI_gAfterEscaping1_;
static IOSCharArray * JavaxXmlParsersFilePathToURI_gAfterEscaping2_;
static IOSCharArray * JavaxXmlParsersFilePathToURI_gHexChs_;

+ (IOSBooleanArray *)gNeedEscaping {
  return JavaxXmlParsersFilePathToURI_gNeedEscaping_;
}

+ (void)setGNeedEscaping:(IOSBooleanArray *)gNeedEscaping {
  JreOperatorRetainedAssign(&JavaxXmlParsersFilePathToURI_gNeedEscaping_, nil, gNeedEscaping);
}

+ (IOSCharArray *)gAfterEscaping1 {
  return JavaxXmlParsersFilePathToURI_gAfterEscaping1_;
}

+ (void)setGAfterEscaping1:(IOSCharArray *)gAfterEscaping1 {
  JreOperatorRetainedAssign(&JavaxXmlParsersFilePathToURI_gAfterEscaping1_, nil, gAfterEscaping1);
}

+ (IOSCharArray *)gAfterEscaping2 {
  return JavaxXmlParsersFilePathToURI_gAfterEscaping2_;
}

+ (void)setGAfterEscaping2:(IOSCharArray *)gAfterEscaping2 {
  JreOperatorRetainedAssign(&JavaxXmlParsersFilePathToURI_gAfterEscaping2_, nil, gAfterEscaping2);
}

+ (IOSCharArray *)gHexChs {
  return JavaxXmlParsersFilePathToURI_gHexChs_;
}

+ (void)setGHexChs:(IOSCharArray *)gHexChs {
  JreOperatorRetainedAssign(&JavaxXmlParsersFilePathToURI_gHexChs_, nil, gHexChs);
}

+ (NSString *)filepath2URIWithNSString:(NSString *)path {
  if (path == nil) return nil;
  unichar separator = JavaIoFile_separatorChar;
  path = [((NSString *) nil_chk(path)) replace:separator withChar:'/'];
  int len = [((NSString *) nil_chk(path)) length], ch;
  JavaLangStringBuilder *buffer = [[[JavaLangStringBuilder alloc] initWithInt:len * 3] autorelease];
  [buffer appendWithNSString:@"file://"];
  if (len >= 2 && [path charAtWithInt:1] == ':') {
    ch = [JavaLangCharacter toUpperCaseWithChar:[path charAtWithInt:0]];
    if (ch >= 'A' && ch <= 'Z') {
      [buffer appendWithChar:'/'];
    }
  }
  int i = 0;
  for (; i < len; i++) {
    ch = [path charAtWithInt:i];
    if (ch >= 128) break;
    if (IOSBooleanArray_Get(nil_chk(JavaxXmlParsersFilePathToURI_gNeedEscaping_), ch)) {
      [buffer appendWithChar:'%'];
      [buffer appendWithChar:IOSCharArray_Get(nil_chk(JavaxXmlParsersFilePathToURI_gAfterEscaping1_), ch)];
      [buffer appendWithChar:IOSCharArray_Get(nil_chk(JavaxXmlParsersFilePathToURI_gAfterEscaping2_), ch)];
    }
    else {
      [buffer appendWithChar:(unichar) ch];
    }
  }
  if (i < len) {
    IOSByteArray *bytes = nil;
    char b;
    @try {
      bytes = [((NSString *) nil_chk([path substring:i])) getBytesWithCharsetName:@"UTF-8"];
    }
    @catch (JavaIoUnsupportedEncodingException *e) {
      return path;
    }
    len = (int) [((IOSByteArray *) nil_chk(bytes)) count];
    for (i = 0; i < len; i++) {
      b = IOSByteArray_Get(bytes, i);
      if (b < 0) {
        ch = b + 256;
        [buffer appendWithChar:'%'];
        [buffer appendWithChar:IOSCharArray_Get(nil_chk(JavaxXmlParsersFilePathToURI_gHexChs_), ch >> 4)];
        [buffer appendWithChar:IOSCharArray_Get(JavaxXmlParsersFilePathToURI_gHexChs_, ch & (int) 0xf)];
      }
      else if (IOSBooleanArray_Get(nil_chk(JavaxXmlParsersFilePathToURI_gNeedEscaping_), b)) {
        [buffer appendWithChar:'%'];
        [buffer appendWithChar:IOSCharArray_Get(nil_chk(JavaxXmlParsersFilePathToURI_gAfterEscaping1_), b)];
        [buffer appendWithChar:IOSCharArray_Get(nil_chk(JavaxXmlParsersFilePathToURI_gAfterEscaping2_), b)];
      }
      else {
        [buffer appendWithChar:(unichar) b];
      }
    }
  }
  return [buffer description];
}

- (id)init {
  return JreMemDebugAdd([super init]);
}

+ (void)initialize {
  if (self == [JavaxXmlParsersFilePathToURI class]) {
    JreOperatorRetainedAssign(&JavaxXmlParsersFilePathToURI_gNeedEscaping_, nil, [IOSBooleanArray arrayWithLength:128]);
    JreOperatorRetainedAssign(&JavaxXmlParsersFilePathToURI_gAfterEscaping1_, nil, [IOSCharArray arrayWithLength:128]);
    JreOperatorRetainedAssign(&JavaxXmlParsersFilePathToURI_gAfterEscaping2_, nil, [IOSCharArray arrayWithLength:128]);
    JreOperatorRetainedAssign(&JavaxXmlParsersFilePathToURI_gHexChs_, nil, [IOSCharArray arrayWithCharacters:(unichar[]){ '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F' } count:16]);
    {
      for (int i = 0; i <= (int) 0x1f; i++) {
        (*IOSBooleanArray_GetRef(JavaxXmlParsersFilePathToURI_gNeedEscaping_, i)) = YES;
        (*IOSCharArray_GetRef(JavaxXmlParsersFilePathToURI_gAfterEscaping1_, i)) = IOSCharArray_Get(JavaxXmlParsersFilePathToURI_gHexChs_, i >> 4);
        (*IOSCharArray_GetRef(JavaxXmlParsersFilePathToURI_gAfterEscaping2_, i)) = IOSCharArray_Get(JavaxXmlParsersFilePathToURI_gHexChs_, i & (int) 0xf);
      }
      (*IOSBooleanArray_GetRef(JavaxXmlParsersFilePathToURI_gNeedEscaping_, (int) 0x7f)) = YES;
      (*IOSCharArray_GetRef(JavaxXmlParsersFilePathToURI_gAfterEscaping1_, (int) 0x7f)) = '7';
      (*IOSCharArray_GetRef(JavaxXmlParsersFilePathToURI_gAfterEscaping2_, (int) 0x7f)) = 'F';
      IOSCharArray *escChs = [IOSCharArray arrayWithCharacters:(unichar[]){ ' ', '<', '>', '#', '%', '"', '{', '}', '|', '\\', '^', '~', '[', ']', '`' } count:15];
      int len = (int) [escChs count];
      unichar ch;
      for (int i = 0; i < len; i++) {
        ch = IOSCharArray_Get(escChs, i);
        (*IOSBooleanArray_GetRef(JavaxXmlParsersFilePathToURI_gNeedEscaping_, ch)) = YES;
        (*IOSCharArray_GetRef(JavaxXmlParsersFilePathToURI_gAfterEscaping1_, ch)) = IOSCharArray_Get(JavaxXmlParsersFilePathToURI_gHexChs_, ch >> 4);
        (*IOSCharArray_GetRef(JavaxXmlParsersFilePathToURI_gAfterEscaping2_, ch)) = IOSCharArray_Get(JavaxXmlParsersFilePathToURI_gHexChs_, ch & (int) 0xf);
      }
    }
  }
}

@end
